<div class="card">
  <div class="card-header">{{title}}</div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Type</th>
            <th>Details</th>
            <th>Status</th>
            <th *ngIf="isAdmin">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let workflow of workflows">
            <td>{{workflow.type}}</td>
            <td>
              <!-- For Employee Transfer type -->
              <ng-container *ngIf="workflow.type === 'Employee Transfer' || workflow.type === 'Transfer'">
                <div class="transfer-details">
                  <div class="row">
                    <div class="col-5 text-center">
                      <div class="dept-name" [ngClass]="{'text-muted': getTransferFrom(workflow.details) === 'Unknown Department' || getTransferFrom(workflow.details) === 'None'}">
                        {{getTransferFrom(workflow.details)}}
                      </div>
                      <div><small>Original Department</small></div>
                    </div>
                    <div class="col-2 text-center">
                      <i class="fas fa-arrow-right transfer-arrow"></i>
                    </div>
                    <div class="col-5 text-center">
                      <div class="dept-name" [ngClass]="{'text-muted': getTransferTo(workflow.details) === 'Unknown Department' || getTransferTo(workflow.details) === 'None'}">
                        {{getTransferTo(workflow.details)}}
                      </div>
                      <div><small>New Department</small></div>
                    </div>
                  </div>
                  <p *ngIf="workflow.details?.effectiveDate" class="mt-2"><strong>Effective Date:</strong> {{workflow.details?.effectiveDate | date}}</p>
                  <p *ngIf="workflow.details?.reason || workflow.details?.message"><small>{{workflow.details?.reason || workflow.details?.message}}</small></p>
                  
                  <!-- Show approval info for pending transfers -->
                  <div *ngIf="workflow.status === 'Pending'" class="alert alert-info mt-2 mb-0 p-2 small">
                    <i class="fas fa-info-circle"></i> This transfer is waiting for approval.
                  </div>
                </div>
              </ng-container>
              
              <!-- For Department Transfer type -->
              <ng-container *ngIf="workflow.type === 'Department Transfer'">
                <div class="transfer-details">
                  <div class="row">
                    <div class="col-5 text-center">
                      <div class="dept-name" [ngClass]="{'text-muted': getTransferFrom(workflow.details) === 'Unknown Department' || getTransferFrom(workflow.details) === 'None'}">
                        {{getTransferFrom(workflow.details)}}
                      </div>
                      <div><small>Original Department</small></div>
                    </div>
                    <div class="col-2 text-center">
                      <i class="fas fa-arrow-right transfer-arrow"></i>
                    </div>
                    <div class="col-5 text-center">
                      <div class="dept-name" [ngClass]="{'text-muted': getTransferTo(workflow.details) === 'Unknown Department' || getTransferTo(workflow.details) === 'None'}">
                        {{getTransferTo(workflow.details)}}
                      </div>
                      <div><small>New Department</small></div>
                    </div>
                  </div>
                  <p *ngIf="workflow.details?.effectiveDate" class="mt-2"><strong>Effective Date:</strong> {{workflow.details?.effectiveDate | date}}</p>
                  <p *ngIf="workflow.details?.reason || workflow.details?.message"><small>{{workflow.details?.reason || workflow.details?.message}}</small></p>
                  
                  <!-- Show approval info for pending transfers -->
                  <div *ngIf="workflow.status === 'Pending'" class="alert alert-info mt-2 mb-0 p-2 small">
                    <i class="fas fa-info-circle"></i> This transfer is waiting for approval.
                  </div>
                </div>
              </ng-container>
              
              <!-- For Request Created type -->
              <ng-container *ngIf="workflow.type === 'Request Created'">
                <div class="request-details">
                  <p><strong>Request Type:</strong> {{workflow.details?.requestType || 'Not specified'}}</p>
                  <p *ngIf="workflow.details?.itemCount"><strong>Items:</strong> {{workflow.details?.itemCount}} item(s)</p>
                  <div *ngIf="workflow.details?.items && workflow.details?.items.length > 0">
                    <p><strong>Requested Items:</strong></p>
                    <ul>
                      <li *ngFor="let item of workflow.details?.items">{{item}}</li>
                    </ul>
                  </div>
                  <p *ngIf="workflow.details?.message"><small>{{workflow.details?.message}}</small></p>
                </div>
              </ng-container>
              
              <!-- For all other workflow types -->
              <ng-container *ngIf="workflow.type !== 'Employee Transfer' && workflow.type !== 'Transfer' && workflow.type !== 'Department Transfer' && workflow.type !== 'Request Created'">
                <div *ngIf="isString(workflow.details)" class="workflow-details">
                  <p>{{workflow.details}}</p>
                </div>
                <div *ngIf="!isString(workflow.details)" class="workflow-details">
                  <p>{{formatWorkflowDetails(workflow.details)}}</p>
                </div>
              </ng-container>
            </td>
            <td>
              <span class="badge" [ngClass]="{
                'bg-warning': workflow.status === 'Pending',
                'bg-success': workflow.status === 'Approved' || workflow.status === 'Completed',
                'bg-danger': workflow.status === 'Rejected'
              }">{{workflow.status}}</span>
            </td>
            <td *ngIf="isAdmin">
              <select class="form-select d-inline-block w-auto" [(ngModel)]="workflow.status" (change)="updateStatus(workflow, $event)">
                <option>Pending</option>
                <option>Approved</option>
                <option>Rejected</option>
                <option>Completed</option>
              </select>
            </td>
          </tr>
          <tr *ngIf="!workflows.length">
            <td colspan="4" class="text-center">
              <span *ngIf="loading" class="spinner-border spinner-border-sm"></span>
              <span *ngIf="!loading">No workflows found</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div> 