{"ast":null,"code":"import { BehaviorSubject, Subject, interval } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nexport let SocketService = /*#__PURE__*/(() => {\n  class SocketService {\n    constructor() {\n      this.onlineUsers = new BehaviorSubject([]);\n      this.registrationStats = new BehaviorSubject({\n        monthlyData: [],\n        totalRegistrations: 0\n      });\n      this.userStatusUpdates = new Subject();\n      this.isConnected = false;\n    }\n    // Simulate connecting to a WebSocket\n    connect() {\n      if (this.isConnected) return;\n      console.log('Socket connecting...');\n      this.isConnected = true;\n      // Simulate periodic updates (in a real app, this would be actual socket events)\n      this.simulationInterval = interval(5000).subscribe(() => {\n        this.updateOnlineStatuses();\n      });\n    }\n    // Simulate disconnecting from a WebSocket\n    disconnect() {\n      if (!this.isConnected) return;\n      console.log('Socket disconnecting...');\n      this.isConnected = false;\n      if (this.simulationInterval) {\n        this.simulationInterval.unsubscribe();\n      }\n    }\n    // Update online users from backend\n    updateOnlineUsers(users) {\n      this.onlineUsers.next(users);\n    }\n    // Update registration stats\n    updateRegistrationStats(stats) {\n      this.registrationStats.next(stats);\n    }\n    // Get online users as observable\n    getOnlineUsers() {\n      return this.onlineUsers.asObservable();\n    }\n    // Get registration stats as observable\n    getRegistrationStats() {\n      return this.registrationStats.asObservable();\n    }\n    // Get single user status changes\n    getUserStatusUpdates() {\n      return this.userStatusUpdates.asObservable();\n    }\n    // Update online statuses based on last active time\n    updateOnlineStatuses() {\n      const currentUsers = this.onlineUsers.value;\n      if (currentUsers.length === 0) return;\n      // Consider a user offline if they haven't been active in the last 5 minutes\n      const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000);\n      const updatedUsers = currentUsers.map(user => {\n        const lastActive = user.lastActive ? new Date(user.lastActive) : null;\n        const isOnline = lastActive && lastActive > fiveMinutesAgo;\n        if (user.isOnline !== isOnline) {\n          user.isOnline = isOnline;\n          this.userStatusUpdates.next({\n            userId: user.id,\n            isOnline: isOnline\n          });\n        }\n        return user;\n      });\n      this.onlineUsers.next(updatedUsers);\n    }\n    // Helper method to get current online count\n    getOnlineCount() {\n      return this.onlineUsers.pipe(map(users => users.filter(u => u.isOnline).length));\n    }\n    // Helper method to get current offline count\n    getOfflineCount() {\n      return this.onlineUsers.pipe(map(users => users.filter(u => !u.isOnline).length));\n    }\n  }\n  SocketService.ɵfac = function SocketService_Factory(t) {\n    return new (t || SocketService)();\n  };\n  SocketService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: SocketService,\n    factory: SocketService.ɵfac,\n    providedIn: 'root'\n  });\n  return SocketService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}